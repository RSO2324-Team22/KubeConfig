apiVersion: v1
kind: Pod
metadata:
  name: webapp
  namespace: default
  labels:
    app: webapp
spec:
  containers:
    - name: webapp
      image: "pusti/rso2324-team22-webapp:latest"
      ports:
        - containerPort: 80
          name:  http
      env:
        - name: MEMBERS_SERVICE_URL
          value: "$(MEMBERS_SERVICE_SERVICE_HOST):$(MEMBERS_SERVICE_SERVICE_PORT)"
        - name: PLANNING_SERVICE_URL
          value: "$(PLANNING_SERVICE_SERVICE_HOST):$(PLANNING_SERVICE_SERVICE_PORT)"
        - name: ATTENDANCE_SERVICE_URL
          value: "$(ATTENDANCE_SERVICE_SERVICE_HOST):$(ATTENDANCE_SERVICE_SERVICE_PORT)"
        - name: RESOURCE_SERVICE_URL
          value: "$(RESOURCE_SERVICE_SERVICE_HOST):$(RESOURCE_SERVICE_SERVICE_PORT)"
      startupProbe:
        httpGet:
          path: /health/startup
          port: http
        initialDelaySeconds: 10
        periodSeconds: 10

---

apiVersion: v1
kind: Service
metadata:
  name: webapp
spec:
  type: ClusterIP
  selector:
    app: webapp
  ports:
    - protocol: TCP
      port: 80
      targetPort: http

---

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: webapp-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  ingressClassName: nginx
  rules:
    - http:
        paths: 
          - path: "/app"
            pathType: Prefix
            backend:
              service:
                name: webapp
                port: 
                  name: http
            
